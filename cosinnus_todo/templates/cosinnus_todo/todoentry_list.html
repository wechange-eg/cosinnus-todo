{% extends "cosinnus_todo/base.html" %}
{% load i18n humanize todo_tags cosinnus_tags %}
{% load static from staticfiles %}


{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/vendor/jquery-ui-1.10.0.custom.css' %}">
<link rel="stylesheet" href="{% static 'css/vendor/select2.css' %}">
<link rel="stylesheet" href="{% static 'css/vendor/datepicker3.css' %}">
<link rel="stylesheet" href="{% static 'bootstrap3_datetime/css/bootstrap-datetimepicker.min.css' %}">
<link rel="stylesheet" href="{% static 'css/cosinnus_todo.css' %}">
{% endblock extrahead %}


{% block page_title %}
{% trans "TodoEntries" %} {{ block.super }}
{% endblock page_title %}


{% block content_title %}
<!--{{ group.name }}: {% trans "TodoEntries" %}-->
{% endblock content_title %}


{% block content %}

{% endblock content %}

{% block ajax_content %}

<div id="main-region">
    <p>Loading ...</p>
</div>

<div id="dialog-region"></div>

<script type="text/template" id="todos-list-layout">
    <h2>Marionette App</h2>
    <div id="todos-top-region"></div>
    <div id="todolists-list-region"></div>
    <div id="todos-list-region"></div>
</script>


<script type="text/template" id="todos-top">
    <ul class="nav nav-pills pull-right">
        {% if user.is_superuser or user|is_group_member:object %}
        <li class="active">
            <a class="btn js-new-todolist">
                <span class="glyphicon glyphicon-plus"></span> {% trans "Add Todolist" %}
            </a>
        </li>
        <li class="active">
            <a class="btn js-new">
                <span class="glyphicon glyphicon-plus"></span> {% trans "Add" %}
            </a>
        </li>
        <li class="active">
            <a href="{% url 'cosinnus:todo:export' group=group.slug %}" class="btn">
                <span class="glyphicon glyphicon-export"></span> {% trans "Export" context "the verb" %}
            </a>
        </li>
        {% endif %}
    </ul>
</script>

<!-- TODO: use static tag? -->
{% include "cosinnus_todo/marionette_templates/lists-items-layout.html" %}
{% include "cosinnus_todo/marionette_templates/lists-item.html" %}
{% include "cosinnus_todo/marionette_templates/lists-new.html" %}

{% include "cosinnus_todo/marionette_templates/todos-item.html" %}
{% include "cosinnus_todo/marionette_templates/todos-new.html" %}


<script type="text/template" id="todolists-list">
</script>

<script type="text/template" id="todolists-list-item">
    <td><a href="../todolist/<%= slug %>/" class="linktd js-todolist-list"><%= title %></a></td>
    <td><%= item_count %></td>
    <td>
        <a  class="btn btn-primary js-todolist-edit">
            <i class="glyphicon glyphicon-pencil"></i>
            Edit
        </a>
        <a  class="btn js-todolist-delete">
            <i class="glyphicon glyphicon-remove"></i>
            Delete
        </a>
    </td>
</script>



<script type="text/template" id="todos-list">
    <thead>
    <tr>
        <th>{% trans "TodoList" %}</th>
        <th>{% trans "Title" %}</th>
        <th>{% trans "Due by" %}</th>
        <th>{% trans "Assigned to" %}</th>
        <th>{% trans "Status" %}</th>
        <th>{% trans "Tags" %}</th>
        <th>{% trans "Actions" %}</th>
    </tr>
    </thead>
    <tbody></tbody>
</script>

<script type="text/template" id="todos-list-item">
    <td><a class="linktd js-list"><%= todolist? todolist.title : '' %></a></td>
    <td><a href="../<%= slug %>" class="linktd js-detail"><%= title %></a></td>
    <td><%= due_date %></td>
    <td>
        <% if (assigned_to) { %>
        <span><%= assigned_to.username %></span>
        <% } %>
        <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <span class="glyphicon glyphicon-cog"></span> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a class="linktd js-assignto-me">Assign ME </a></li>
                <li><a class="linktd js-unassign">Unassign</a></li>
            </ul>
        </div>
    </td>
    <td>
        <% if (is_completed) { %>
            <span class="badge badge-success"
                  title="<%= completed_date %> -- <% if (assigned_to) { %><%= completed_by.username %><% } %>">
                {% trans "Completed" %}
            </span>

        <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <span class="glyphicon glyphicon-cog"></span> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a class="linktd js-incomplete">Set to incomplete</a></li>   
            </ul>
        </div>
        <% } else { %>
            <span class="badge badge-important">
                {% trans "Open" %}
            </span>

        <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <span class="glyphicon glyphicon-cog"></span> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a class="linktd js-completedme">Complete by me</a></li> 
                <li><a class="linktd js-completedme">Completed by Someone else</a></li> 
            </ul>
        </div>
        <% } %>
    </td>
    <td><%= tags %></td>
    <td>
        <a href="../<%= slug %>/edit" class="btn btn-primary js-edit">
            <i class="glyphicon glyphicon-pencil"></i>
            Edit
        </a>
        <a href="../<%= slug %>/delete" class="btn js-delete">
            <i class="glyphicon glyphicon-remove"></i>
            Delete
        </a>
    </td>
</script>

<script type="text/template" id="todos-detail">
    <h1>{{ group.name }}: <%= title %></h1>

    <div class="row">
        <div class="col-md-6">
            <strong>{% trans "Created on" %}</strong>
            <%= created %>
            {% trans "by" context "done by someone" %}
            <% if (created) { %>
            <%= created.username %>
            <% } %>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <% if (due_date) { %>
            <strong>{% trans "Due by" %}</strong>
            <%= due_date %>
            <% } else { %>
            <strong>{% trans "No due date" %}</strong>
            <% } %>
        </div>
        <div class="col-md-6">
            <% if (completed_date) { %>
            <strong>{% trans "Completed on" %}</strong>
            <%= completed_date %>
            <% if (completed_by) { %>{% trans "by" context "done by someone" %} <%= completed_by.username %><% } %>
            <% } else { %>
            <strong>{% trans "Not completed" %}</strong>
            <% } %>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <% if (assigned_to) { %>
            <strong>{% trans "Assigned to" %}</strong>
            <%= assigned_to.username %>
            <% } else { %>
            <strong>{% trans "Not assigned" %}</strong>
            <% } %>
        </div>
        <div class="col-md-6">
            <strong>{% trans "Priority" %}</strong>
            <%= priority %>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <% if (note) { %>
            <strong>{% trans "Note" %}</strong><br/>
            <div class="well"><%= note %></div>
            <% } %>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <strong>{% trans "Tags" %}</strong><br/>
            <% for(var tag in tags) { %>
            <a href="<%= tags[tag] %>">
                <span class="label label-default"><%= tags[tag] %></span>
            </a>
            <% } %>
        </div>
    </div>
</script>

<script type="text/template" id="todos-detail-missing">
    <div class="container">
        <h1>Die Aufgabe existiert nicht.</h1>
    </div>
</script>


<script type="text/template" id="todolist-edit-form">
    <form role="form">
        <div class="form-group">
            <label for="todo-title" class="control-label">{% trans "Title" %}:</label>
            <input id="todo-title" name="title" class="form-control" type="text" value="<%= title %>"/>
        </div>
        <button type="submit" class="btn btn-default js-submit">{% trans "Save" %}</button>
    </form>
</script>

<script type="text/template" id="todos-edit-form">
    <form role="form">
        <div class="form-group">
            <label for="todo-title" class="control-label">{% trans "Title" %}:</label>
            <input id="todo-title" name="title" class="form-control" type="text" value="<%= title %>"/>
        </div>
        <div class="form-group">
            <label for="todo-todolist" class="control-label">{% trans "Todolist" %}:</label>
            <input id="todo-todolist" name="todolist" class="form-control" type="text" value="<%= todolist.id %>"/>
        </div>
        <div class="form-group">
            <label for="todo-due_date" class="control-label">{% trans "Due by" %}</label>
            <input id="todo-due_date" name="due_date" class="form-control" type="text" value="<%= due_date %>"/>
        </div>
        <div class="form-group">
            <label for="todo-assigned_to" class="control-label">{% trans "Assigned to" %}</label>
            <input id="todo-assigned_to" <% if (assigned_to) { %>name="assigned_to"<% } %> class="form-control"
            type="text" value="<% if (assigned_to) { %><%= assigned_to.id %><% } %>"/>
        </div>
        <div class="form-group">
            <label for="todo-is_completed" class="control-label">{% trans "Status" %}</label>
            <input id="todo-is_completed" name="is_completed" class="form-control" type="text"
                   value="<%= is_completed %>"/>
        </div>
        <div class="form-group">
            <label for="todo-is_completed" class="control-label">{% trans "Tags" %}</label>
        </div>
        <div class="form-group">
            <label for="todo-is_completed" class="control-label">{% trans "Actions" %}</label>
        </div>
        <button type="submit" class="btn btn-default js-submit">{% trans "Save" %}</button>
    </form>
</script>


{% endblock ajax_content %}


{% block extrafooter %}
{{ block.super }}
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.core.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.widget.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.mouse.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.position.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.resizable.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.draggable.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.button.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery.ui.dialog.js' %}"></script>

<script src="{% static 'js/vendor/json2.js' %}"></script>
<script src="{% static 'js/vendor/underscore.js' %}"></script>
<script src="{% static 'js/vendor/backbone.js' %}"></script>
<script src="{% static 'js/vendor/backbone.syphon.js' %}"></script>
<script src="{% static 'js/vendor/backbone.marionette.js' %}"></script>
<script src="{% static 'js/vendor/keymaster.js' %}"></script>
<script src="{% static 'js/vendor/select2.min.js' %}"></script>
<script src="{% static 'js/vendor/moment.js' %}"></script>
<script src="{% static 'bootstrap3_datetime/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'bootstrap3_datetime/js/locales/bootstrap-datetimepicker.de.js' %}"></script>
<script src="{% static 'js/vendor/locales/moment.de.js' %}"></script>

<script src="{% static 'js/common/common.js' %}"></script>

<script src="{% static 'js/apps/config/marionette/regions/dialog.js' %}"></script>

<script src="{% static 'js/cosinnus_todo.js' %}"></script>
<script src="{% static 'js/common/lists/lists_views.js' %}"></script>

<script src="{% static 'js/entities/todo_entities.js' %}"></script>

<script src="{% static 'js/apps/todos/todos_app.js' %}"></script>
<script src="{% static 'js/apps/todos/common/common_views.js' %}"></script>
<script src="{% static 'js/apps/todos/list/todos_list_view.js' %}"></script>
<script src="{% static 'js/apps/todos/list/todos_list_controller.js' %}"></script>
<script src="{% static 'js/apps/todos/detail/todos_detail_view.js' %}"></script>
<script src="{% static 'js/apps/todos/detail/todos_detail_controller.js' %}"></script>
<script src="{% static 'js/apps/todos/edit/todos_edit_view.js' %}"></script>
<script src="{% static 'js/apps/todos/edit/todos_edit_controller.js' %}"></script>
<script src="{% static 'js/apps/todos/edit/todos_edit_todolist_view.js' %}"></script>
<script src="{% static 'js/apps/todos/edit/todos_edit_todolist_controller.js' %}"></script>
<script src="{% static 'js/apps/todos/new/todos_new_view.js' %}"></script>
<script src="{% static 'js/apps/todos/new/todos_new_todolist_view.js' %}"></script>

<script type="text/javascript">
    CosinnusApp.start();
</script>

{% endblock extrafooter %}
